{% extends "core/base.html" %}
{% load static %}
{% block content %}

    <div class="gradient-header">
        <div class="container py-3 text-white">
            <div class="row h-100 align-items-center py-5">
                <div class="col-lg-8">
                    <h1 class="display-4">Explore COVID-19 Preprints</h1>
                    <p class="muted-white lead mb-0">
                        Since 13th January 2019, {{ papers|length }} articles, concerning the COVID-19 virus, are published on preprint
                        servers and collected by <strong>Collabovid</strong>. Most of
                        these papers are not reviewed in a professional reviewing process at the time of publication on
                        the preprint server. You can search for any topic you want below.
                        Visit <a class="muted-white" href="{% url "explore" %}">explore</a> to review all articles or browse a list of
                        predefined <a class="muted-white" href="{% url "topic-overview" %}">topics</a>. For additional help visit the
                        <a class="muted-white" href="{% url "about" %}">frequently asked questions</a>.

                    </p>
                </div>
                <div class="col-lg-4">
                    <img src="{% static "core/img/research-2.png" %}" class="img-fluid rounded">
                </div>
            </div>

        </div>

        <div class="container">
            <br/>
            <div class="row justify-content-center">
                <div class="col-12 col-md-10 col-lg-8">
                    <form class="card card-sm rounded-corners" action="{% url "home" %}" method="POST"
                          id="topic-search-form">
                        {% csrf_token %}
                        <div class="card-body row no-gutters align-items-center">
                            <div class="col-auto">
                                <i class="fas fa-search fa-2x text-body"></i>
                            </div>
                            <!--end of col-->
                            <div class="col">
                                <input name="query"
                                       class="form-control form-control-lg form-control-borderless" type="search"
                                       placeholder="E.g.: What do we know about vaccines and therapeutics?">
                            </div>
                            <!--end of col-->
                            <div class="col-auto">
                                <button class="btn btn-lg btn-info" type="submit">Search</button>
                            </div>
                            <!--end of col-->
                        </div>
                    </form>
                </div>
                <!--end of col-->
            </div>
        </div>
        {% include 'core/partials/_rounded_bottom.html' %}
    </div>

    <div id="paper-container" class="container">
    </div>


    <div id="paper-loading-indicator" class="text-center fa-5x" style="display: none;">
        <i class="fas fa-spinner fa-spin"></i>
    </div>


{% endblock %}

{% block script %}
    {% include 'core/partials/_paper_card.html' with script=True %}

    <script type="text/javascript">
        $(document).ready(function () {

            window.Pagination = {};

            let indicator = $("#paper-loading-indicator");
            let paper_container = $("#paper-container");
            let form = $("#topic-search-form");

            function search_query(data) {

                $.ajax({
                    url: form.attr("action"),
                    type: 'POST',
                    data: data,
                    success: function (data) {
                        paper_container.html(data);

                        indicator.hide();
                        paper_container.fadeIn();
                    },
                    error: function (request, error) {
                        console.log("Request: " + JSON.stringify(request));
                        console.log("Error: " + error);
                    }
                });
            }

            form.submit(function (e) {
                e.preventDefault();

                paper_container.hide();
                indicator.show();

                search_query(form.serialize());
            });

        });
    </script>
{% endblock %}

{% block css %}
{% endblock %}
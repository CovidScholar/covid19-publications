option_settings:
  aws:elasticbeanstalk:container:python:
    WSGIPath: covid19_publications/wsgi.py
  aws:elasticbeanstalk:application:environment:
    DJANGO_SETTINGS_MODULE: covid19_publications.prod_settings
    USE_PAPER_ANALYZER: 1

files:
  "/etc/httpd/conf.d/wsgi_custom.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      WSGIApplicationGroup %{GLOBAL}
  "/opt/elasticbeanstalk/tasks/taillogs.d/django.conf":
    mode: "000755"
    owner: root
    group: root
    content: |
      /var/log/app-logs/django.log
  "/opt/elasticbeanstalk/tasks/taillogs.d/cron.conf":
    mode: "000755"
    owner: root
    group: root
    content: |
      /var/log/app-logs/cron.log

packages:
  yum:
    git: []
    postgresql93-devel: []
    poppler-utils: []

container_commands:
  00_create_dir:
    command: mkdir -p /var/log/app-logs
  01_change_permissions:
    command: chmod g+s /var/log/app-logs
  02_change_owner:
    command: chown wsgi:wsgi /var/log/app-logs
  03_change_default_owner:
    command: setfacl -d -m g::rw /var/log/app-logs
  10_static:
    command: "python manage.py collectstatic"
  20_migrate:
    command: "python manage.py migrate"
  30_lda:
    command: "python setup/lda_setup.py"
  40_superuser:
    command: "python setup/create_superuser.py"
  50_set_permissions:
    command: "chmod 777 analyze/res && chmod 666 analyze/res/*"
  80_remove_cron:
    command: "python manage.py crontab remove"
  90_add_cron:
    command: "python manage.py crontab add"




